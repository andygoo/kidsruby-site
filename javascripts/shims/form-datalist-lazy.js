webshims.register("form-datalist-lazy",function(t,i,e,s,a,l){var o=0,n=t.webshims.cfg.forms,r={},p=function(t){if(!t)return[];if(r[t])return r[t];var i;try{i=JSON.parse(localStorage.getItem("storedDatalistOptions"+t))}catch(e){}return r[t]=i||[],i||[]},h=function(t,i){if(t){i=i||[];try{localStorage.setItem("storedDatalistOptions"+t,JSON.stringify(i))}catch(e){}}},d=/</g,u=/>/g,c=/\s*,\s*/g;t.extend(l.shadowListProto,{_lazyCreate:function(s){var o=this;this.hideList=t.proxy(o,"hideList"),this.popover=i.objectCreate(i.wsPopover,{},l.datalistPopover),this.shadowList=this.popover.element.addClass("datalist-polyfill"),this.index=-1,this.input=s.input,this.arrayOptions=[],this.shadowList.delegate("li","mouseenter.datalistWidget mousedown.datalistWidget click.datalistWidget",function(i){var e=t("li:not(.hidden-item)",o.shadowList),a="mousedown"==i.type||"click"==i.type;return o.markItem(e.index(i.currentTarget),a,e),"click"==i.type&&(o.hideList(),n.customDatalist&&t(s.input).getNativeElement().trigger("datalistselect")),"mousedown"!=i.type}),s.input.setAttribute("autocomplete","off"),t(s.input).attr({"aria-haspopup":"true"}).on({"input.datalistWidget":function(){o.triggeredByDatalist||(o.changedValue=!1,o.showHideOptions())},"keydown.datalistWidget":function(i){var e,l,r=i.keyCode;return 40!=r||o.showList()?o.popover.isVisible?38==r?(o.markItem(o.index-1,!0),!1):i.shiftKey||33!=r&&36!=r?i.shiftKey||34!=r&&35!=r?(13==r||27==r)&&(13==r&&(e=t("li.active-item:not(.hidden-item)",o.shadowList),o.changeValue(t("li.active-item:not(.hidden-item)",o.shadowList))),o.hideList(),n.customDatalist&&e&&e[0]&&t(s.input).getNativeElement().trigger("datalistselect"),13!=i.keyCode||e&&e[0])?!1:a:(l=t("li:not(.hidden-item)",o.shadowList),o.markItem(l.length-1,!0,l),!1):(o.markItem(0,!0),!1):a:(o.markItem(o.index+1,!0),!1)},"focus.datalistWidget":function(){t(this).hasClass("list-focus")&&o.showList()},"mousedown.datalistWidget":function(){t(this).is(":focus")&&o.showList()}}),t(this.datalist).off("updateDatalist.datalistWidget").on("updateDatalist.datalistWidget",t.proxy(this,"_resetListCached")).on("remove",function(t){t.originalEvent||o.detroy()}),this._resetListCached(),s.input.form&&(s.input.name||s.input.id)&&t(s.input.form).on("submit.datalistWidget"+s.input.id,function(){if(!t(s.input).hasClass("no-datalist-cache")&&"off"!=o._autocomplete){var i=t.prop(s.input,"value"),e=(s.input.name||s.input.id)+t.prop(s.input,"type");o.storedOptions||(o.storedOptions=p(e)),i&&-1==o.storedOptions.indexOf(i)&&(o.storedOptions.push(i),h(e,o.storedOptions))}}),t(e).on("unload.datalist"+this.id+" beforeunload.datalist"+this.id,function(t){o.destroy(t)})},_resetListCached:function(){var i,s=this;this.needsUpdate=!0,this.lastUpdatedValue=!1,this.lastUnfoundValue="",this.updateTimer||(e.QUnit||(i=t(s.input).is(":focus")&&(t(s.input).hasClass("list-focus")||t.prop(s.input,"value")))?s.updateListOptions(i):s.updateTimer=setTimeout(function(){s.updateListOptions(),s=null,o=1},200+100*o))},updateListOptions:function(e){this.needsUpdate=!1,clearTimeout(this.updateTimer),this.updateTimer=!1,(t(this.input).hasClass("ws-nosearch")||t(this.input).hasClass("search-start"))&&i.error('please use listFilter/data-list-filer configuration with values: "*", "^" or "!"'),this.addMarkElement=l.addMark||t(this.input).hasClass("mark-option-text"),this.listFilter=t(this.input).data("listFilter")||l.listFilter||"*",this.multiple=t(this.input).hasClass("list-multiple")||t(this.input).prop("multiple")&&"email"==t(this.input).prop("type");var s,a,o,n,r,h,c,m=[],f=[],v=[];for(o=t.prop(this.datalist,"options"),n=0,r=o.length;r>n;n++)s=o[n],!s.disabled&&(c=t(s).val())&&(a={value:c.replace(d,"&lt;").replace(u,"&gt;"),label:t.trim(t.attr(s,"label"))||"",className:s.className||"",elem:l.getOptionContent?s:null},a.label&&(a.className+=" has-option-label"),f.push(a.value),v.push(a));for(this.storedOptions||(this.storedOptions=t(this.input).hasClass("no-datalist-cache")||"off"==this._autocomplete?[]:p((this.input.name||this.input.id)+t.prop(this.input,"type"))),this.storedOptions.forEach(function(t){-1==f.indexOf(t)&&v.push({value:t,label:"",className:"stored-suggest",style:""})}),n=0,r=v.length;r>n;n++)h=v[n],m[n]='<li class="'+h.className+'" tabindex="-1" role="listitem">'+this.getOptionContent(h)+"</li>";this.arrayOptions=v,this.popover.contentElement.html('<div class="datalist-box"><ul role="list">'+m.join("\n")+"</ul></div>"),l.datalistCreated&&l.datalistCreated.apply(this),(e||this.popover.isVisible)&&this.showHideOptions()},getOptionContent:function(t){var i;return l.getOptionContent&&(i=l.getOptionContent.apply(this,arguments),null!=i&&(i+='<span class="option-value" style="display: none;">'+t.value+"</span>")),null==i&&(i='<span class="option-value">'+t.value+"</span>",t.label&&(i+=' <span class="option-label">'+t.label+"</span>")),i||""},showHideOptions:function(i){var e=t.prop(this.input,"value").toLowerCase();if(e!==this.lastUpdatedValue){if(this.multiple&&(e=e.split(c),e=e[e.length-1]||""),this.lastUnfoundValue&&0===e.indexOf(this.lastUnfoundValue))return this.hideList(),a;this.lastUpdatedValue=e;var s=!1,l="^"==this.listFilter,o=t("li",this.shadowList),n=this;e&&"!"!=this.listFilter?this.arrayOptions.forEach(function(i,a){var r,p,h;"lowerValue"in i||(i.lowerValue=i.value.toLowerCase(),i.label&&i.label!=i.value&&(i.lowerLabel=i.label.toLowerCase())),e!=i.lowerValue&&i.lowerLabel!=e&&(p=i.lowerValue.indexOf(e),r=l?!p:-1!==p,r?h="value":i.lowerLabel&&(p=i.lowerLabel.indexOf(e),r=l?!p:-1!==p,h="label")),r?(n.addMark(t(o[a]).removeClass("hidden-item"),i,h,p,e.length),s=!0):t(o[a]).addClass("hidden-item")}):o.length&&(this.removeMark(o.removeClass("hidden-item")),s=!0),this.hasViewableData=s,!i&&s&&(this.popover.isVisible&&"bottom"==this.popover.element.attr("data-vertical")&&this.popover.element.triggerHandler("pospopover"),this.showList()),s?this.lastUnfoundValue=!1:(this.lastUnfoundValue=e,this.hideList())}},otherType:{value:"label",label:"value"},addMark:function(i,e,s,a,l){if(this.addMarkElement){var o=e[s].substr(a,l);o=e[s].replace(o,"<mark>"+o+"</mark>"),t(".option-"+this.otherType[s]+" > mark",i).each(this._replaceMark),t(".option-"+s,i).html(o)}},_replaceMark:function(){var i=t(this).html();t(this).replaceWith(i)},removeMark:function(i){this.addMarkElement&&t("mark",i).each(this._replaceMark)},showList:function(){if(this.popover.isVisible)return!1;if(this.needsUpdate&&this.updateListOptions(),this.showHideOptions(!0),!this.hasViewableData)return!1;var t=this;return t.shadowList.find("li.active-item").removeClass("active-item"),t.popover.show(this.input),!0},hideList:function(){if(!this.popover.isVisible)return!1;var i=this;return this.popover.hide(),i.shadowList.removeClass("datalist-visible list-item-active"),i.index=-1,i.changedValue&&(i.triggeredByDatalist=!0,t(i.input).trigger("input").trigger("change"),i.changedValue=!1,i.triggeredByDatalist=!1),!0},scrollIntoView:function(i){var e,s=t("ul",this.shadowList),l=t("div.datalist-box",this.shadowList),o=i.position();return o.top-=(parseInt(s.css("paddingTop"),10)||0)+(parseInt(s.css("marginTop"),10)||0)+(parseInt(s.css("borderTopWidth"),10)||0),0>o.top?(l.scrollTop(l.scrollTop()+o.top-2),a):(o.top+=i.outerHeight(),e=l.height(),o.top>e&&l.scrollTop(l.scrollTop()+(o.top-e)+2),a)},changeValue:function(i){if(i[0]){var e,s,a=t("span.option-value",i).text(),l=t.prop(this.input,"value");this.multiple&&(s=l.split(c),s[s.length-1]=a,a=s.join(", ")),a!=l&&(t(this.input).prop("value",a).triggerHandler("updateInput"),this.changedValue=!0,(e=t.data(this.input,"wsspinner"))&&e.setInput&&e.setInput(a))}},markItem:function(i,e,s){var a;s=s||t("li:not(.hidden-item)",this.shadowList),s.length&&(0>i?i=s.length-1:i>=s.length&&(i=0),s.removeClass("active-item"),this.shadowList.addClass("list-item-active"),a=s.filter(":eq("+i+")").addClass("active-item"),e&&(this.changeValue(a),this.scrollIntoView(a)),this.index=i)}})});